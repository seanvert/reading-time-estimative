* reading time estimative
** o que está faltando
*** ☛ TODO colocar os domínios das funções
*** ☛ TODO arrumar as docstrings
*** ☛ TODO colocar um esquema para marcar com o org-noter
*** ☛ TODO ajeitar o tangle

** variáveis capítulos
#+begin_src emacs-lisp 
(setq skip-start-chapters '("Cover" "Title Page" "Copyright"
							"Dedication" "About The Author"
							"Foreword" "Preface" "Contents"))

(setq skip-end-chapters '("References" "Index"))
#+end_src

** variáveis com configurações

#+begin_src emacs-lisp
;; default do máximo que ele vai pra dentro no índice
(setq max-depth 1)
#+end_src

** pega as variáveis dos pdfs
;; TODO certificar que está num modo pdf
;; nesta função e na get-outline

;; roda essa função no modo de pdf
;; TODO checa se existe outline

#+begin_src emacs-lisp
(defun get-total-pages ()
  (progn (define-pdf-cache-function number-of-pages)
		 (setq number-of-pages (pdf-cache-number-of-pages))))

(defun get-outline ()
  (progn (define-pdf-cache-function outline)
		 (setq outline (pdf-cache-outline))))
#+end_src

** outline parse

#+begin_src emacs-lisp
(defun teste (outline)
  "função que pega uma entrada do outline e retorna o nome e o número da página"
  ;; TODO checar se está de acordo com o default em depth
  (if (<= (cdr (assoc 'depth outline)) max-depth)
	  ;; check membership in chapters
	  ;; TODO tirar os end chapters e analisar só até a primeira entrada
	  (if (not (member (cdr (assoc 'title outline))
					   (append skip-start-chapters skip-end-chapters)))
		  ;; return values
		  (list (cdr (assoc 'title outline))
				(cdr (assoc 'page outline)))
		;; TODO arrumar isso daqui e pensar num jeito melhor pra ver isso
		;; acho que chegar o end chapters seria uma boa
		"fim")))


#+end_src

*** teste
#+begin_src emacs-lisp
(teste (nth 8 outline))
(teste (nth 9 outline))

;; exemplo de um pedaço
;; (((depth . 1) (type . goto-dest) (title . "Chapter 21 - Progressing As A Cognitive Behavior Therapist") (page . 380) (top . 0)))
#+end_src

*** arruma isso

#+begin_src emacs-lisp
;; TODO ajeitar isso
(setq outlineum (mapcar #'teste outline))
(setq outlineum (remove nil (mapcar #'teste outline)))
(setq outlineum (remove "fim" outlineum))
#+end_src


** pega o total de páginas por capítulo

#+begin_src emacs-lisp
;; TODO get pages and subtract get the total per chapter
(defun get-total-per-chapter (outl acc)
  "get pages and subtract to get the total per chapter"
  (if (= 0 (length outl))
	  acc
	(get-total-per-chapter (cdr-safe outl)
						   (cons (list (car (car outl))
									   (- (if (cdr-safe outl)
											  (car (cdr (car (cdr outl)))) ;; next element page number
															number-of-pages)
										  (car (cdr (car outl))))) ;; first element page number
								 acc))))

;; (("Chapter 21 - Progressing As A Cognitive Behavior Therapist" 34) ("Chapter 20 - Problems In Therapy" 12) ("Chapter 19 - Treatment Planning" 14) ("Chapter 18 - Termination And Relapse Prevention" 16) ("Chapter 17 - Homework" 22) ("Chapter 16 - Imagery" 17) ("Chapter 15 - Additional Cognitive And Behavioral Techniques" 21) ("Chapter 14 - Identifying And Modifying Core Beliefs" 28) ("Chapter 13 - Identifying And Modifying Intermediate Beliefs" 30) ("Chapter 12 - Responding To Automatic Thoughts" 11) ("Chapter 11 - Evaluating Automatic Thoughts" 20) ("Chapter 10 - Identifying Emotions" 9) ("Chapter 9 - Identifying Automatic Thoughts" 21) ("Chapter 8 - Problems With Structuring The Therapy Session" 14) ("Chapter 7 - Session 2 And Beyond: Structure And Format" 23) ("Chapter 6 - Behavioral Activation" 20) ("Chapter 5 - Structure Of The First Therapy Session" 21) ("Chapter 4 - The Evaluation Session" 13) ("Chapter 3 - Cognitive Conceptualization" 17) ("Chapter 2 - Overview Of Treatment" 12) ("Chapter 1 - Introduction To Cognitive Behavior Therapy" 16))
#+end_src

*** seq

#+begin_src emacs-lisp
(setq outlinedois (reverse (get-total-per-chapter outlineum '())))
#+end_src

** pega o tempo das coisas
#+begin_src emacs-lisp
;; TODO FAZER O BÁSICO PRIMEIRO
(setq pdf-time-before 0)
(setq pdf-time-after 0)
;; TODO adicionar uma função para chamar isso
(add-hook 'pdf-view-after-change-page-hook
		  (lambda () (progn (set-pdf-time-after)
					   (message (int-to-string (- pdf-time-after pdf-time-before)))
					   (set-pdf-time-before))))

(defun set-pdf-time-after ()
  (setq pdf-time-after (hhmmtomm
						(car (split-string
							  (substring-no-properties display-time-string)
							  " ")))))

(defun set-pdf-time-before ()
  (setq pdf-time-before (hhmmtomm
						 (car (split-string
							   (substring-no-properties display-time-string)
							   " ")))))

;; TODO uma função que checa se avançamos nas páginas
(defun pdf-check-page-advance ()
  (interactive)
  "checks if we are going forward on non-read pages"
  (if (not (member (pdf-view-current-page) pdf-time-pages))
	  (setq pdf-time-pages (append (pdf-view-current-page)))))

(setq page-rate 3)
;; TODO uma função que conta o tempo numa página
;; TODO uma outra função que estima o tempo final
;; TODO uma função que pega a última página como algo arbitrário para remover índices no final
#+end_src

** aplica o tempo nos capítulo

#+begin_src emacs-lisp
(defun get-chapters-time (outline)
  "Function that gets the OUTLINE rate and apply it to the time."
  (list (car outline)
		(* page-rate (car (cdr outline)))))

(mapcar* #'get-chapters-time outlinedois)

;; (("Chapter 1 - Introduction To Cognitive Behavior Therapy" 48) ("Chapter 2 - Overview Of Treatment" 36) ("Chapter 3 - Cognitive Conceptualization" 51) ("Chapter 4 - The Evaluation Session" 39) ("Chapter 5 - Structure Of The First Therapy Session" 63) ("Chapter 6 - Behavioral Activation" 60) ("Chapter 7 - Session 2 And Beyond: Structure And Format" 69) ("Chapter 8 - Problems With Structuring The Therapy Session" 42) ("Chapter 9 - Identifying Automatic Thoughts" 63) ("Chapter 10 - Identifying Emotions" 27) ("Chapter 11 - Evaluating Automatic Thoughts" 60) ("Chapter 12 - Responding To Automatic Thoughts" 33) ("Chapter 13 - Identifying And Modifying Intermediate Beliefs" 90) ("Chapter 14 - Identifying And Modifying Core Beliefs" 84) ("Chapter 15 - Additional Cognitive And Behavioral Techniques" 63) ("Chapter 16 - Imagery" 51) ("Chapter 17 - Homework" 66) ("Chapter 18 - Termination And Relapse Prevention" 48) ("Chapter 19 - Treatment Planning" 42) ("Chapter 20 - Problems In Therapy" 36) ("Chapter 21 - Progressing As A Cognitive Behavior Therapist" 102))
#+end_src

